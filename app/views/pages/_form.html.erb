<div class="row">
<%= form_for(@page) do |f| %>
  <% if @page.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@page.errors.count, "error") %> prohibited this page from being saved:</h2>

      <ul>
      <% @page.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  <div class="col-md-8">
    <% @subdomain = request.subdomain %>
    <% @site = Site.where(subdomain: request.subdomain).first.id %>
    <%= f.hidden_field :site_id, value: @site %>
    <div class="form-group">
      <%= f.label :title, "Page Title" %>
      <%= f.text_field :title, class: "form-control" %>
      <p>Your page's main heading</p>
    </div>
    <div class="form-group">
      <%= f.label :subtitle, "Page Subtitle" %>
      <%= f.text_field :subtitle, class: "form-control" %>
      <p>Your page's sub heading</p>
    </div>
    <div class="form-group">
      <%= f.label :content, "Page Content" %>
      <%= f.text_area :content, class: "form-control" %>
    </div>
    <div class="admin-bar" id="quick-access" style="bottom: 0px;">
      <div class="admin-bar-inner">
        <%= f.submit "Save Page", class: "btn btn-success" %>
      </div>
    </div>
  </div><!-- end col 8 -->
  <div class="col-md-4">
    <div class="add-page-image center">
      <% if f.object.page_image? %>
        <div class="upload-preview">
          <%= image_tag(@page.page_image.url(:medium), id: "uploadimage", class: "img-thumbnail") %>
        </div>
      <% else %>
        <div class="upload-preview">
          <%= image_tag("upload-image.png", id: "uploadimage") %>
        </div>
      <% end %>
      <div class="row-fluid">
        <%= f.file_field :page_image, as: :file, id: 'lefile', style: "display:none;" %>
        <div class="input-append">
          <a class="btn btn-white btn-block" onclick="$('input[id=lefile]').click();">Upload Image</a>
          <p style="font-size:12px; padding-top:25px; margin:0" class="muted">JPEG file, 2mb max</p>
        </div>
        <script type="text/javascript">
          $('input[id=lefile]').change(function() {
            $('#photoCover').val($(this).val());
          });
        </script>
      </div>
    </div>
  </div><!-- end col 4 -->
<% end %>
</div>

<script type="text/javascript">
var preview = $(".upload-preview img");
    
    $("#lefile").change(function(event){
       var input = $(event.currentTarget);
       var file = input[0].files[0];
       var reader = new FileReader();
       reader.onload = function(e){
           image_base64 = e.target.result;
           preview.attr("src", image_base64);
       };
       reader.readAsDataURL(file);
       $('#uploadimage').css('width', '100%').css('height', '170px');
       $('#uploadprofileimage').css('width', '80px').css('height', '80px');
    });
    
</script>
